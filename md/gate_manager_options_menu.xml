<?xml version="1.0" encoding="utf-8"?>
<mdscript name="Gate_Manager_Options_Menu" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <cues>
    <cue name="Init" instantiate="false">
      <actions>
      </actions>
      <cues>
        <library name="Ensure_Variables" purpose="include_actions">
          <actions>
            <set_value name="$textGreen" exact="'Color.button_content_default'" />
            <set_value name="$textGray" exact="'Color.button_content_default_inverse'" />
            <include_actions ref="md.Gate_Manager_Interface.Init_Variables" />
          </actions>
        </library>

        <cue name="Register_Menu" instantiate="true">
          <conditions>
            <event_cue_signalled cue="md.Simple_Menu_API.Reloaded" />
          </conditions>
          <actions>
            <debug_text text="'Gate Manager Options: Registering Options Menus'" context="false" filter="scripts" />
            <include_actions ref="Ensure_Variables" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu"
              param="table[
                $id      = 'gate_manager_options_menu',
                $columns = 8,
                $title   = {1972092407, 1},
                $onOpen  = Main_Menu,
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu"
              param="table[
                $id      = 'gate_manager_options_gate',
                $columns = 8,
                $title   = '%s %s'.[{20001, 701}, {1001, 3405}],
                $onOpen  = Gate_Options_Menu,
                $private = 1,
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu"
              param="table[
                $id      = 'gate_manager_options_accelerator',
                $columns = 8,
                $title   = '%s %s'.[{20001, 1001}, {1001, 3405}],
                $onOpen  = Accelerator_Options_Menu,
                $private = 1,
              ]" />
          </actions>
        </cue>
        <cue name="Main_Menu" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <debug_text text="'Gate Manager Options: Opening Main Menu'" context="false" filter="scripts" />
            <include_actions ref="Ensure_Variables" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Submenu_Link"
              param="table[$text = '%s %s'.[{20001, 701}, {1001, 3405}], $id = 'gate_manager_options_gate']" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Submenu_Link"
              param="table[$text = '%s %s'.[{20001, 1001}, {1001, 3405}], $id = 'gate_manager_options_accelerator']" />
          </actions>
        </cue>

        <cue name="Gate_Options_Menu" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <debug_text text="'Gate Manager Options: Opening Gate Options Menu'" context="false" filter="scripts" />
            <include_actions ref="Ensure_Variables" />
            <run_actions ref="Render_Options_Template">
              <param name="type" value="'gate'" />
              <param name="macroOneValue" value="'props_gates_anc_gate_macro'" />
              <param name="macroTwoValue" value="'props_gates_anc_gate_anim_macro'" />
              <param name="buildValue" value="player.entity.$gateManagerCosts.$gateBuild" />
              <param name="connectValue" value="player.entity.$gateManagerCosts.$gateConnect" />
              <param name="disconnectValue" value="player.entity.$gateManagerCosts.$gateDisconnect" />
              <param name="textSelected" value="$textGreen" />
              <param name="textUnselected" value="$textGray" />
            </run_actions>
          </actions>
        </cue>

        <cue name="Accelerator_Options_Menu" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <debug_text text="'Gate Manager Options: Opening Accelerator Options Menu'" context="false" filter="scripts" />
            <include_actions ref="Ensure_Variables" />
            <run_actions ref="Render_Options_Template">
              <param name="type" value="'accelerator'" />
              <param name="macroOneValue" value="'props_gates_orb_accelerator_01_macro'" />
              <param name="macroTwoValue" value="'props_gates_orb_accelerator_02_macro'" />
              <param name="buildValue" value="player.entity.$gateManagerCosts.$acceleratorBuild" />
              <param name="connectValue" value="player.entity.$gateManagerCosts.$acceleratorConnect" />
              <param name="disconnectValue" value="player.entity.$gateManagerCosts.$acceleratorDisconnect" />
              <param name="textSelected" value="$textGreen" />
              <param name="textUnselected" value="$textGray" />
            </run_actions>
          </actions>
        </cue>

        <cue name="Execute_SetMacro" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <debug_text text="'Gate Manager Options: Executing SetMacro'" context="false" filter="scripts" />
            <do_if value="event.param.$echo? and event.param.$echo.$type? and event.param.$echo.$value?">
              <set_value name="$type" exact="event.param.$echo.$type" />
              <set_value name="$value" exact="event.param.$echo.$value" />
              <do_if value="$type == 'gate'">
                <set_value name="player.entity.$gateManagerGateMacro" exact="$value" />
              </do_if>
              <do_elseif value="$type == 'accelerator'">
                <set_value name="player.entity.$gateManagerAcceleratorMacro" exact="$value" />
              </do_elseif>
              <debug_text text="'Gate Manager Options: Updated %s macro to %s'.[$type, $value]" context="false" filter="scripts" />
              <remove_value name="$type" />
              <remove_value name="$value" />
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu" />
          </actions>
        </cue>

        <cue name="Execute_UpdateCost" instantiate="true">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <debug_text text="'Gate Manager Options: Executing UpdateCost'" context="false" filter="scripts" />
            <do_if value="event.param.$echo? and event.param.$echo.$type? and event.param.$echo.$category?">
              <set_value name="$type" exact="event.param.$echo.$type" />
              <set_value name="$category" exact="event.param.$echo.$category" />
              <set_value name="$value" exact="event.param.$value" />
              <debug_text text="'Gate Manager Options: Updating %s %s cost to %s'.[$type, $category, $value]" context="false" filter="scripts" />
              <do_if value="$category == 'build'">
                <do_if value="$type == 'gate'">
                  <run_actions ref="Execute_SetCost" result="player.entity.$gateManagerCosts.$gateBuild">
                    <param name="current" value="player.entity.$gateManagerCosts.$gateBuild" />
                    <param name="new" value="$value" />
                    <param name="part" value="event.param.$echo.$part" />
                  </run_actions>
                </do_if>
                <do_elseif value="$type == 'accelerator'">
                  <run_actions ref="Execute_SetCost" result="player.entity.$gateManagerCosts.$acceleratorBuild">
                    <param name="current" value="player.entity.$gateManagerCosts.$acceleratorBuild" />
                    <param name="new" value="$value" />
                    <param name="part" value="event.param.$echo.$part" />
                  </run_actions>
                </do_elseif>
              </do_if>
              <do_elseif value="$category == 'connect'">
                <do_if value="$type == 'gate'">
                  <run_actions ref="Execute_SetCost" result="player.entity.$gateManagerCosts.$gateConnect">
                    <param name="current" value="player.entity.$gateManagerCosts.$gateConnect" />
                    <param name="new" value="$value" />
                    <param name="part" value="event.param.$echo.$part" />
                  </run_actions>
                </do_if>
                <do_elseif value="$type == 'accelerator'">
                  <run_actions ref="Execute_SetCost" result="player.entity.$gateManagerCosts.$acceleratorConnect">
                    <param name="current" value="player.entity.$gateManagerCosts.$acceleratorConnect" />
                    <param name="new" value="$value" />
                    <param name="part" value="event.param.$echo.$part" />
                  </run_actions>
                </do_elseif>
              </do_elseif>
              <do_elseif value="$category == 'disconnect'">
                <do_if value="$type == 'gate'">
                  <run_actions ref="Execute_SetCost" result="player.entity.$gateManagerCosts.$gateDisconnect">
                    <param name="current" value="player.entity.$gateManagerCosts.$gateDisconnect" />
                    <param name="new" value="$value" />
                    <param name="part" value="event.param.$echo.$part" />
                  </run_actions>
                </do_if>
                <do_elseif value="$type == 'accelerator'">
                  <run_actions ref="Execute_SetCost" result="player.entity.$gateManagerCosts.$acceleratorDisconnect">
                    <param name="current" value="player.entity.$gateManagerCosts.$acceleratorDisconnect" />
                    <param name="new" value="$value" />
                    <param name="part" value="event.param.$echo.$part" />
                  </run_actions>
                </do_elseif>
              </do_elseif>
              <debug_text text="'Gate Manager Options: Updated %s %s cost to %s'.[$type, $category, $value]" context="false" filter="scripts" />
              <remove_value name="$type" />
              <remove_value name="$category" />
              <remove_value name="$value" />
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu" />
          </actions>
        </cue>

        <library name="Execute_SetCost" purpose="run_actions">
          <params>
            <param name="current" />
            <param name="new" />
            <param name="part" />
          </params>
          <actions>
            <set_value name="$result" exact="($current)L" />
            <set_value name="$splitter" exact="100000000L" />
            <debug_text text="'Gate Manager Options: Calculating Cost - Current: %s, New: %s, Part: %s'.[$current, $new, $part]" context="false"
              filter="scripts" />
            <do_if value="$part == 'tens_of_millions'">
              <debug_text
                text="'Gate Manager Options: Updating tens_of_millions part: %s - %s + %s'.[($current)L, ($current)L % $splitter, ($new)L % $splitter]"
                context="false" filter="scripts" />
              <set_value name="$result" exact="($current)L - ($current)L % $splitter + ($new)L % $splitter" />
            </do_if>
            <do_elseif value="$part == 'hundreds_of_millions'">
              <debug_text
                text="'Gate Manager Options: Updating hundreds_of_millions part: %s + %s'.[($new)L, ($current)L % $splitter]"
                context="false" filter="scripts" />
              <set_value name="$result" exact="($new)L + ($current)L % $splitter" />
            </do_elseif>
            <remove_value name="$splitter" />
            <return value="$result" />
          </actions>
        </library>

        <library name="Render_Options_Template" purpose="run_actions">
          <params>
            <param name="type" />
            <param name="macroOneValue" />
            <param name="macroTwoValue" />
            <param name="buildValue" />
            <param name="connectValue" />
            <param name="disconnectValue" />
            <param name="textSelected" />
            <param name="textUnselected" />
          </params>
          <actions>
            <debug_text text="'Gate Manager Options: Rendering Options Template'" context="false" filter="scripts" />
            <set_value name="$macroCurrent"
              exact="if $type == 'gate' then player.entity.$gateManagerGateMacro else player.entity.$gateManagerAcceleratorMacro" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 2,
                $text = if $type == 'gate' then {20001, 701} else {20001, 1001}
              ]" />
            <set_value name="$macroOneSelected" exact="$macroCurrent == $macroOneValue" />
            <set_value name="$macroTwoSelected" exact="$macroCurrent == $macroTwoValue" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button"
              param="table[
                $col = 3,
                $colSpan = 3,
                $text = table[
                  $text   = {20111, 5302},
                  $color  = if $macroOneSelected then $textSelected else $textUnselected,
                  $halign = 'center',
                ],
                $onClick = Execute_SetMacro,
                $onRightClick = Execute_SetMacro,
                $echo = table[
                  $type  = $type,
                  $value = $macroOneValue,
                ],
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button"
              param="table[
                $col = 6,
                $colSpan = 3,
                $text = table[
                  $text   = {20111, 5303},
                  $color  = if $macroTwoSelected then $textSelected else $textUnselected,
                  $halign = 'center',
                ],
                $onClick = Execute_SetMacro,
                $onRightClick = Execute_SetMacro,
                $echo = table[
                  $type  = $type,
                  $value = $macroTwoValue,
                ],
              ]" />
            <remove_value name="$macroCurrent" />
            <remove_value name="$macroOneSelected" />
            <remove_value name="$macroTwoSelected" />

            <run_actions ref="Render_Cost_Template">
              <param name="type" value="$type" />
              <param name="name" value="{1972092407, 3021}" />
              <param name="value" value="$buildValue" />
              <param name="textSelected" value="$textSelected" />
              <param name="category" value="'build'" />
            </run_actions>

            <run_actions ref="Render_Cost_Template">
              <param name="type" value="$type" />
              <param name="name" value="{1972092407, 3022}" />
              <param name="value" value="$connectValue" />
              <param name="textSelected" value="$textSelected" />
              <param name="category" value="'connect'" />
            </run_actions>

            <run_actions ref="Render_Cost_Template">
              <param name="type" value="$type" />
              <param name="name" value="{1972092407, 3023}" />
              <param name="value" value="$disconnectValue" />
              <param name="textSelected" value="$textSelected" />
              <param name="category" value="'disconnect'" />
            </run_actions>
          </actions>
        </library>

        <library name="Render_Cost_Template" purpose="run_actions">
          <params>
            <param name="type" />
            <param name="name" />
            <param name="value" />
            <param name="category" />
            <param name="textSelected" />
          </params>
          <actions>
            <debug_text text="'Gate Manager Options: Rendering Cost Template'" context="false" filter="scripts" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />

            <set_value name="$step" exact="10000000" />
            <set_value name="$max" exact="90000000" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 4,
                $titleColor = 'Color.text_normal',
                $text = $name,
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 5,
                $colSpan = 4,
                $color  = $textSelected,
                $titleColor = 'Color.text_normal',
                $halign = 'right',
                $text = '%,s %s.'.[$value, {1001, 101}],
              ]" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 3,
                $text = '  %s'.[{1972092407, 3031}]
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider"
              param="table[
                $col = 4,
                $colSpan = 5,
                $min = 0,
                $max = $max,
                $step = $step,
                $start = ($value)L % 100000000 - ($value)L % 1000000,
                $suffix = ' %s.'.[{1001, 101}],
                $onSliderCellConfirm = Execute_UpdateCost,
                $echo = table[
                  $type     = $type,
                  $category = $category,
                  $part     = 'tens_of_millions',
                ],
              ]" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />

            <set_value name="$step" exact="100000000" />
            <set_value name="$max" exact="1000000000" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 3,
                $text = '  %s'.[{1972092407, 3032}]
              ]" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider"
              param="table[
                $col = 4,
                $colSpan = 5,
                $min = 0,
                $max = $max,
                $step = $step,
                $start = ($value)L - ($value)L % 100000000L,
                $suffix = ' %s.'.[{1001, 101}],
                $onSliderCellConfirm = Execute_UpdateCost,
                $echo = table[
                  $type     = $type,
                  $category = $category,
                  $part     = 'hundreds_of_millions',
                ],
              ]" />
            <remove_value name="$step" />
            <remove_value name="$max" />
          </actions>
        </library>
      </cues>
    </cue>


  </cues>
</mdscript>